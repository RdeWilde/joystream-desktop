platform:
  - x64

environment:
  # Githib deploy ssh key
  priv_key: value
  # Githib personal access token
  GITHUB_TOKEN: value
  # Base64 encoded string signing cert to be written to disk
  CODE_SIGN_CERT_URL: value
  # Path to Authenticode Code Signing Certificate
  ELECTRON_FORGE_ELECTRON_WINSTALLER_CONFIG_CERTIFICATE_FILE: value
  # Password to decrypt code signing cert
  ELECTRON_FORGE_ELECTRON_WINSTALLER_CONFIG_CERTIFICATE_PASSWORD: value

init:
  - git config --global core.autocrlf input

install:
  - ps: Install-Product node 7 x64
  - ps: $fileContent = "-----BEGIN RSA PRIVATE KEY-----`n"
  - ps: $fileContent += $env:priv_key.Replace(' ', "`n")
  - ps: $fileContent += "`n-----END RSA PRIVATE KEY-----`n"
  - ps: Set-Content c:\users\appveyor\.ssh\id_rsa $fileContent
  - ps: Start-FileDownload $env:CODE_SIGN_CERT_URL -FileName $env:ELECTRON_FORGE_ELECTRON_WINSTALLER_CONFIG_CERTIFICATE_FILE
  # stick to old version of npm until issue is resolved: https://github.com/npm/npm/issues/17671
  - npm install -g npm@5.2.0
  - npm config set loglevel warn
  - npm install -g electron-forge
  - npm install -g electron-prebuilt-compile@1.6.4
  - npm install -g electron-rebuild
  - pip install conan
  - conan remote add joystream https://conan.joystream.co:9300 True
  - conan user travis -p trav444 -r=joystream

build_script:
  - npm install
  - mkdir C:\Users\appveyor\.electron-gyp
  - mklink /J C:\Users\appveyor\.electron-gyp\.conan C:\Users\appveyor\.conan
  - electron-rebuild

deploy_script:
  - electron-forge publish

test: on

test_script:
  npm test

branches:
    only:
      - /^release_\d_\d_\d/
