platform:
  - x64

environment:
  priv_key:
    secure: <encryped-value>
  GITHUB_TOKEN:
    secure: <encryped-value>

init:
  - git config --global core.autocrlf input

install:
  - ps: Install-Product node 7 x64
  - ps: $fileContent = "-----BEGIN RSA PRIVATE KEY-----`n"
  - ps: $fileContent += $env:priv_key.Replace(' ', "`n")
  - ps: $fileContent += "`n-----END RSA PRIVATE KEY-----`n"
  - ps: Set-Content c:\users\appveyor\.ssh\id_rsa $fileContent
  - npm install npm -g
  - npm install -g electron-forge
  - npm install -g electron-prebuilt-compile@1.6.4
  - npm install -g electron-rebuild
  - pip install conan
  - conan remote add joystream https://conan.joystream.co:9300 True
  - conan user travis -p trav444 -r=joystream
  - npm install
  - electron-rebuild

build_script:
  - mkdir C:\Users\appveyor\.electron-gyp
  - mklink /J C:\Users\appveyor\.electron-gyp\.conan C:\Users\appveyor\.conan
  - electron-forge publish

test: on

test_script:
  npm test

branches:
    only:
      - master
      - appveyor
